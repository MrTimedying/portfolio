class f{static generateNormalSamples(t,e,s){const n=[];for(let i=0;i<t;i+=2){const r=Math.random(),o=Math.random(),l=Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*o),c=Math.sqrt(-2*Math.log(r))*Math.sin(2*Math.PI*o);n.push(l*s+e),i+1<t&&n.push(c*s+e)}return n.slice(0,t)}static sampleWithoutReplacement(t,e){const s=Array.from({length:t.length},(i,r)=>r),n=[];for(let i=0;i<e;i++){const r=Math.floor(Math.random()*s.length);n.push(s[r]),s.splice(r,1)}return n.map(i=>t[i])}static mean(t){return t.reduce((e,s)=>e+s,0)/t.length}static std(t){const e=this.mean(t),s=t.reduce((n,i)=>n+Math.pow(i-e,2),0)/(t.length-1);return Math.sqrt(s)}static welchTTest(t,e){const s=t.length,n=e.length,i=this.mean(t),r=this.mean(e),o=this.std(t),l=this.std(e),c=Math.sqrt(o*o/s+l*l/n),h=(i-r)/c,a=Math.pow(o*o/s+l*l/n,2)/(Math.pow(o*o/s,2)/(s-1)+Math.pow(l*l/n,2)/(n-1)),m=2*(1-this.tCDF(Math.abs(h),a));return{tStat:h,pValue:m,df:a}}static tCDF(t,e){if(e===1)return .5+Math.atan(t)/Math.PI;const s=e/(e+t*t);return 1-.5*this.incompleteBeta(e/2,.5,s)}static incompleteBeta(t,e,s){if(s<=0)return 0;if(s>=1)return 1;const n=Math.exp(this.logGamma(t+e)-this.logGamma(t)-this.logGamma(e)+t*Math.log(s)+e*Math.log(1-s));return s<(t+1)/(t+e+2)?n*this.continuedFractionBeta(t,e,s)/t:1-n*this.continuedFractionBeta(e,t,1-s)/e}static logGamma(t){const e=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];if(t<.5)return Math.log(Math.PI)-Math.log(Math.sin(Math.PI*t))-this.logGamma(1-t);t-=1;let s=e[0];for(let i=1;i<e.length;i++)s+=e[i]/(t+i);const n=t+e.length-1.5;return .5*Math.log(2*Math.PI)+(t+.5)*Math.log(n)-n+Math.log(s)}static continuedFractionBeta(t,e,s){let r=1,o=1-(t+e)*s/(t+1);Math.abs(o)<1e-15&&(o=1e-15),o=1/o;let l=o;for(let c=1;c<=200;c++){const h=2*c;let a=c*(e-c)*s/((t+h-1)*(t+h));o=1+a*o,Math.abs(o)<1e-15&&(o=1e-15),r=1+a/r,Math.abs(r)<1e-15&&(r=1e-15),o=1/o,l*=o*r,a=-(t+c)*(t+e+c)*s/((t+h)*(t+h+1)),o=1+a*o,Math.abs(o)<1e-15&&(o=1e-15),r=1+a/r,Math.abs(r)<1e-15&&(r=1e-15),o=1/o;const m=o*r;if(l*=m,Math.abs(m-1)<1e-15)break}return l}static cohenD(t,e){const s=this.mean(t),n=this.mean(e),i=this.std(t),r=this.std(e),o=t.length,l=e.length,c=Math.sqrt(((o-1)*i*i+(l-1)*r*r)/(o+l-2));return(s-n)/c}static confidenceInterval(t,e,s){const n=this.mean(t),i=this.mean(e),r=this.std(t),o=this.std(e),l=t.length,c=e.length,h=n-i,a=Math.sqrt(r*r/l+o*o/c),m=1-s,S=l+c-2,u=this.tInverse(1-m/2,S)*a;return{lower:h-u,upper:h+u}}static tInverse(t,e){if(e>=30)return this.normalInverse(t);const s=this.normalInverse(t),n=(s*s*s+s)/(4*e)+(5*s*s*s*s*s+16*s*s*s+3*s)/(96*e*e);return s+n}static normalInverse(t){if(t<=0)return-1/0;if(t>=1)return 1/0;if(t===.5)return 0;const e=[0,-39.69683028665376,220.9460984245205,-275.9285104469687,138.357751867269,-30.66479806614716,2.506628277459239],s=[0,-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572],n=t>.5?1-t:t,i=Math.sqrt(-2*Math.log(n));let r=e[6];for(let c=5;c>=1;c--)r=r*i+e[c];let o=s[5];for(let c=4;c>=1;c--)o=o*i+s[c];let l=i-r/o;return t>.5?l:-l}}function P(d){const{samplePairs:t,simulationCount:e,confidenceLevel:s}=d,n={effectSize:[],pValues:[],ciGaps:[],upperBounds:[],lowerBounds:[],log10P:[],sValues:[],meanEffectSize:0,meanCIGap:0,powerAtThresholds:{},completedSimulations:0,samplePairResults:[]};if(!t||t.length===0)return n;let i=0;return t.forEach((r,o)=>{const{population1:l,population2:c,sampleSize:h}=r,a={samplePairName:r.name,sampleSize:h,trueEffectSize:0,effectSize:[],pValues:[],ciGaps:[],upperBounds:[],lowerBounds:[],log10P:[],sValues:[],meanEffectSize:0,meanCIGap:0,powerAtThresholds:{}},m=Math.sqrt((l.std*l.std+c.std*c.std)/2);a.trueEffectSize=Math.abs(l.mean-c.mean)/m;const S=f.generateNormalSamples(l.size,l.mean,l.std),w=f.generateNormalSamples(c.size,c.mean,c.std);for(let u=0;u<e;u++)try{const p=f.sampleWithoutReplacement(S,h),g=f.sampleWithoutReplacement(w,h),I=f.welchTTest(p,g),E=f.cohenD(p,g),M=f.confidenceInterval(p,g,s);if(a.effectSize.push(E),a.pValues.push(I.pValue),a.ciGaps.push(M.upper-M.lower),a.upperBounds.push(M.upper),a.lowerBounds.push(M.lower),a.log10P.push(Math.log10(I.pValue)),a.sValues.push(-Math.log2(I.pValue)),i++,i%100===0||o===t.length-1&&u===e-1){const z=t.length*e;self.postMessage({type:"SIMULATION_PROGRESS",id:d.id,progress:i/z,data:{completedSimulations:i}})}}catch{}a.meanEffectSize=a.effectSize.reduce((u,p)=>u+p,0)/e,a.meanCIGap=a.ciGaps.reduce((u,p)=>u+p,0)/e,d.significanceThresholds.forEach(u=>{const p=a.pValues.filter(g=>g<u).length;a.powerAtThresholds[u.toString()]=p/e}),n.samplePairResults.push(a),o===0&&(n.effectSize=[...a.effectSize],n.pValues=[...a.pValues],n.ciGaps=[...a.ciGaps],n.upperBounds=[...a.upperBounds],n.lowerBounds=[...a.lowerBounds],n.log10P=[...a.log10P],n.sValues=[...a.sValues],n.meanEffectSize=a.meanEffectSize,n.meanCIGap=a.meanCIGap,n.powerAtThresholds={...a.powerAtThresholds},n.sampleSize=a.sampleSize,n.trueEffectSize=a.trueEffectSize,n.samplePairName=a.samplePairName)}),n.completedSimulations=i,n}self.onmessage=function(d){const{type:t,id:e,data:s}=d.data;try{switch(t){case"TEST":self.postMessage({type:"TEST_RESPONSE",id:e,data:"Worker communication working!"});break;case"SIMULATION_START":const n=s;if(!n)throw new Error("No configuration provided");if(!n.samplePairs||n.samplePairs.length===0)throw new Error("Invalid simulation configuration: no sample pairs");if(!n.simulationCount||n.simulationCount<=0)throw new Error("Invalid simulation configuration: simulation count must be positive");const i=P(n);self.postMessage({type:"SIMULATION_COMPLETE",id:e,data:i});break;default:throw new Error(`Unknown message type: ${t}`)}}catch(n){self.postMessage({type:"SIMULATION_ERROR",id:e,error:n instanceof Error?n.message:"Unknown error"})}};
//# sourceMappingURL=simulation.worker-D7EjXoom.js.map
